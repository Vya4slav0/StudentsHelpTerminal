<Page x:Class="StudentsHelpTerminal.Views.MainScreenPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:StudentsHelpTerminal.Views"
      xmlns:vm="clr-namespace:StudentsHelpTerminal.ViewModels"
      xmlns:m="clr-namespace:StudentsHelpTerminal.Models.Other"
      xmlns:custom="clr-namespace:TerminalCustomControls;assembly=TerminalCustomControls"
      xmlns:conv="clr-namespace:BindingConverters;assembly=BindingConverters"
      xmlns:dv="clr-namespace:DocumentViewers;assembly=DocumentViewers"
      xmlns:locconv="clr-namespace:StudentsHelpTerminal.BindingConverters"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="MainScreenPage">

    <d:Page.DataContext>
        <vm:MainPageViewModel/>
    </d:Page.DataContext>
    
    <Page.Resources>

        <ResourceDictionary Source="\Resources\MainTheme.xaml"/>

    </Page.Resources>

    <Page.Background>
        <VisualBrush>
            <VisualBrush.Visual>
                <Grid Background="White">
                    <Path Fill="#00B0FC" Data="M16256 7982l0 -142 -14217 0c-25,-4 -333,-312 -337,-338l0 -3113c11,-38 132,-145 166,-180 35,-33 143,-155 180,-166l5189 0c-274,330 -269,126 -269,537 0,273 0,545 0,818 0,545 2,1090 0,1634 0,125 23,127 151,251 71,69 134,135 204,204 48,48 62,51 151,51l2252 0c2176,-1 4354,-5 6530,0l0 -142 -8808 0c-40,-12 -140,-128 -175,-162 -34,-33 -151,-139 -163,-176l0 -2669c4,-27 321,-342 346,-346l4632 0 -244 247c-46,54 -33,128 -33,212l3 2364c9,45 143,162 177,196l187 187c27,28 37,40 87,44 127,11 804,1 991,1l3000 1 0 -142 -3965 -1c-23,-4 -334,-314 -338,-337 -1,-591 0,-1183 0,-1774 0,-59 -7,-635 5,-664l330 -330c35,-15 3660,-5 3968,-4l0 -142c-2787,-12 -5577,-2 -8365,0l-5226 0c-173,0 -347,0 -521,0 -194,0 -157,-20 -346,177 -44,46 -85,86 -131,130 -35,34 -104,84 -107,154 -8,166 0,355 0,523l0 2617c0,99 46,118 94,168l261 261c71,68 91,51 211,51l5757 0c2791,-1 5582,4 8373,0z" />
                    
                    <Path Fill="#00B0FC" Data="M15771 179c65,-26 107,80 35,108 -63,25 -120,-73 -35,-108zm-15768 9175l142 0 0 -8704c12,-38 133,-144 167,-179 33,-34 143,-156 180,-167l15094 0c26,6 21,45 88,94 124,90 313,-2 314,-165 0,-173 -227,-284 -359,-123 -19,24 -15,40 -43,52 -4127,-4 -8254,0 -12381,0l-2705 0c-114,-1 -127,46 -237,155 -66,65 -126,125 -191,191 -95,96 -69,119 -69,325l0 8521z" />

                    <Path Fill="#00B0FC" Data="M16110 2736c66,-27 107,80 35,108 -63,24 -121,-74 -35,-108zm-15420 6618l142 0 0 -6156c3,-10 318,-333 347,-338l14747 0c20,5 84,161 238,125 48,-11 58,-25 92,-41l0 -310c-31,-15 -42,-28 -84,-39 -83,-22 -170,17 -215,87 -17,27 -5,25 -31,36l-14678 0c-183,0 -150,11 -246,103l-257 257c-33,33 -54,52 -55,120 -2,228 0,458 0,687 0,1823 -1,3646 0,5469z" />
                    <Path Fill="#00B0FC" Data="M2285 4474c65,-26 107,81 35,109 -57,22 -122,-74 -35,-109zm13971 3291l0 -142 -14036 0 -272 -273c-54,-53 -47,-35 -46,-135l0 -2200c4,-23 276,-291 303,-310 209,98 385,-145 249,-305 -99,-116 -279,-84 -335,43 -31,70 -16,87 -11,157 -93,86 -185,185 -277,277 -79,80 -71,60 -71,208l1 2243c9,61 92,126 126,161 43,43 245,261 293,273 70,17 461,3 564,3l13512 0z" />
                    <Path Fill="#00B0FC" Data="M1038 9354l142 0 0 -296c12,-37 132,-145 166,-180 33,-33 146,-155 180,-166l14730 0 0 -142c-2666,3 -5333,0 -8000,0l-5999 0c-168,0 -336,0 -505,0 -309,0 -262,-32 -398,99 -87,84 -167,166 -252,252 -67,68 -64,65 -64,190 0,81 0,162 0,243z" />
                    <Path Fill="#00B0FC" Data="M1377 9354l142 0 0 -43c12,-39 132,-145 167,-180 33,-33 144,-156 179,-167l14391 0 0 -142 -13486 0c-115,0 -922,-7 -963,4 -43,11 -211,193 -248,230 -163,162 -182,143 -182,298z" />
                    <Path Fill="#00B0FC" Data="M1739 9354l198 0c32,-37 74,-71 111,-105 28,-26 25,-31 78,-31l14130 1 0 -137c-2464,0 -4927,0 -7391,0l-6704 0c-89,0 -140,-13 -188,41 -51,56 -215,181 -234,231z" />
                </Grid>
            </VisualBrush.Visual>
        </VisualBrush>
    </Page.Background>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <!--LEFT SIDE-->
        <Grid Grid.Column="0">
            
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="10"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <custom:PersonalInfoControl FirstName="{Binding Name}"
                                        Surname="{Binding Surname}"
                                        Group="{Binding GroupWithPrefix}"
                                        CardNum="{Binding CardNumWithPrefix}"
                                        Photo="{Binding Photo}"
                                        FrameStyle="{StaticResource SemiOpacityBorder}"
                                        MainTextStyle="{StaticResource TextBlockBig}"
                                        OtherTextStyle="{StaticResource TextBlockMedium}"/>

            <!--BUTTONS-->
            <StackPanel Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2">
                
                <StackPanel.Resources>
                    
                </StackPanel.Resources>
                
                <custom:ButtonCuttedCorners Content="Карта колледжа" Command="{Binding CollegeMapOpenCommand}"/>
                <custom:ButtonCuttedCorners Content="Панель администратора" Command="{Binding AdminWindowOpenCommand}"/>
                <custom:ButtonCuttedCorners Content="Частые вопросы"/>
                <custom:ButtonCuttedCorners Content="Выйти" Command="{StaticResource NavigateToIdlePageCommand}"/>
            </StackPanel>
        </Grid>

        <!--RIGHT SIDE-->
        <Grid Grid.Column="1" Margin="30 0 0 0">
            
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" 
                    Style="{StaticResource SemiOpacityBorder}" 
                    MaxHeight="150">

                <Border.Resources>

                    <Style TargetType="ListBox">
                        <Setter Property="Background">
                            <Setter.Value>
                                <SolidColorBrush Opacity="0"/>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="ItemTemplate">
                            <Setter.Value>
                                <DataTemplate DataType="{x:Type m:DocumentsListItem}">
                                    <StackPanel Orientation="Horizontal">
                                        <Image Source="{Binding DocIcon}" Height="20" Stretch="UniformToFill"/>
                                        <TextBlock Text="{Binding VisibleName}" Margin="5 0 0 0" Style="{StaticResource TextBlockSmall}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>

                    <CollectionViewSource Source="{Binding AvailableDocs}" x:Key="cvs">
                        <CollectionViewSource.GroupDescriptions>
                            <PropertyGroupDescription PropertyName="DocType"/>
                        </CollectionViewSource.GroupDescriptions>
                    </CollectionViewSource>

                    <locconv:DocTypeToTextConverter x:Key="DocTypeToTextConverter"/>

                </Border.Resources>

                <ListBox x:Name="ListBoxDocs"
                         ItemsSource="{Binding Source={StaticResource cvs}}">
                    <ListBox.GroupStyle>
                        <GroupStyle>
                            <GroupStyle.ContainerStyle>
                                <Style TargetType="{x:Type GroupItem}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <Expander IsExpanded="False">
                                                    <Expander.Header>
                                                        <TextBlock Text="{Binding Name, Converter={StaticResource DocTypeToTextConverter}}" 
                                                                   Style="{StaticResource TextBlockSmall}"/>

                                                    </Expander.Header>
                                                    <ItemsPresenter />
                                                </Expander>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </GroupStyle.ContainerStyle>
                        </GroupStyle>
                    </ListBox.GroupStyle>
                </ListBox>

            </Border>

            <Border Grid.Row="1" Margin="0 10 0 0" Style="{StaticResource SemiOpacityBorder}">
                <dv:DocumentViewerWPFHost FilePath="{Binding ElementName=ListBoxDocs, Path=SelectedItem}"/>
            </Border>
            
        </Grid>

    </Grid>
</Page>
